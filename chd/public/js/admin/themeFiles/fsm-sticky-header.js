var fsm=angular.module("fsm",[]);fsm.directive("fsmStickyHeader",function(){return{restrict:"EA",replace:!1,scope:{scrollBody:"=",scrollStop:"=",scrollableContainer:"="},link:function(t,e,n,s){function i(){a=c,c=a.clone(),a.after(c),a.addClass("fsm-sticky-header"),a.css({position:"fixed","z-index":1029,visibility:"hidden"}),o()}function o(){a.css({top:t.scrollStop,width:c.outerWidth(),left:c.offset().left}),r()}function r(){if(a.is("tr")){var t=a.find("th");c.find("th").each(function(e,n){var s=$(t[e]);s.css("width",n.offsetWidth+"px")})}}function l(){var e=d.scrollTop()+t.scrollStop,n=f.offset().top,s=n+f.outerHeight(!1);if(e>n&&s>e)if(a||(i(),a.css({visibility:"visible"})),s>e&&e>s-a.outerHeight(!1)){var r=s-e+t.scrollStop-a.outerHeight(!1);a.css("top",r+"px")}else o();else a&&(c.remove(),c=a,a=null,c.removeClass("fsm-sticky-header"),c.css({position:"relative",left:0,top:0,width:"auto","z-index":0,visibility:"visible"}))}var c=$(e,this),a=null,f=$(t.scrollBody),d=$(t.scrollableContainer);0==d.length&&(d=$(window)),d.scroll(l).trigger("scroll"),d.resize(l)}}}),fsm.directive("fsmMenuButton",function(){return{restrict:"EA",replace:!1,scope:{},link:function(t,e,n,s){function i(){$("body").toggleClass("fsm-menu-toggle"),o(),setTimeout(o,50)}function o(){r.find(".fsm-menu-button-open").toggleClass("fsm-spin-forward"),r.find(".fsm-menu-button-closed").toggleClass("fsm-spin-backward")}var r=$(e,this);r.addClass("fsm-menu-button"),r.click(i)}}}),fsm.directive("fsmBigData",["$filter",function(t){return{restrict:"AE",scope:!0,replace:!1,transclude:!0,link:function(e,n,s,i,o){var r=t("orderBy"),l=0,c=s.fsmBigData.split(" of ")[0],a=s.fsmBigData.split(" of ")[1],f=parseInt(a.split(" take ")[1]),d=a.split(" take ")[0],p=[],u=[],m=[],g=$(window),h=["None","Ascending","Descending"],v=[];e.sortTypes=h,o(e,function(t,s){function i(){var t=u.slice(f*l,f*(l+1));t.length>0&&(m.push.apply(m,t),l++)}function o(t,e){for(var n=0;n<v.length;n++)v[n].indexOf(t)>-1&&v.splice(n,1);if(e>0){var s="";"Descending"===h[e]&&(s="-"),v.unshift(s+t)}a()}function a(){u=v.length?r(p,v):p,m.length=0,l=0,i()}function w(){var t=$(window).scrollTop(),e=$(document).height(),n=$(window).height();scrollPercent=t/(e-n),scrollPercent>.98&&s.$apply(i)}n.append(t),s[c]=m,g.scroll(w).trigger("scroll"),e.$parent.$watchCollection(d,function(t){t&&(p=t,a())}),e.addSortColumn=o})}}}]),fsm.directive("fsmSort",function(){var t='<i class="md md-sort"></i>';return{restrict:"A",replace:!1,scope:{},link:function(e,n,s){function i(){l.removeClass("md-arrow-drop-down md-arrow-drop-up md-sort ");var t="md-sort";"Ascending"===e.$parent.sortTypes[c]?t="md-arrow-drop-down":"Descending"===e.$parent.sortTypes[c]&&(t="md-arrow-drop-up"),l.addClass(t)}var o=n,r=s.fsmSort,l=angular.element(t);o.append("&nbsp;"),o.append(l);var c=0;o.css({cursor:"pointer"}),o.bind("click",function(){c++,c==e.$parent.sortTypes.length&&(c=0),e.$apply(e.$parent.addSortColumn(r,c)),i()})}}});