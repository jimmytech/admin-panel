"use strict";var app=angular.module("myApp",["ngRoute","ngMaterial","ngMessages","ui.bootstrap","angular-toasty","ngCookies"]);app.run(["$rootScope","$location",function(e,t){e.$on("$routeChangeSuccess",function(){var o=t.path();e.headerAndSidebar="/"==o}),e.$on("$routeChangeError",function(e,o,n,r){r.authentication===!0?t.path("/my-profile"):t.path("/")}),e.$on("$routeChangeStart",function(){var o=["/how-it-works","/about-us"];"/"==t.path()||o.indexOf(t.path())>=0?e.homePage=!0:e.homePage=!1})}]).config(["$mdDateLocaleProvider",function(e){e.formatDate=function(e){return moment(e).format("DD-MM-YYYY")}}]).config(["toastyConfigProvider",function(e){e.setConfig({sound:!0,shake:!1,position:"top-right"})}]).config(["$httpProvider",function(e){e.interceptors.push(["$q",function(e){return{request:function(t){t.headers=t.headers||{};var o=localStorage.getItem("token");return o&&(t.headers.Authorization="Bearer "+o),t||e.when(t)},response:function(t){return t||e.when(t)}}}])}]),app.config(["$routeProvider","$locationProvider",function(e,t){e.when("/",{templateUrl:"frontend/landing/views/landing.html",controller:"landingCtrl",resolve:{validate:notRequired}}).when("/home",{templateUrl:"frontend/home/views/home.html",resolve:{validate:notRequired}}).when("/search-listing",{templateUrl:"frontend/search/views/search_listing.html",controller:"searchCtrl",resolve:{validate:required}}).when("/my-profile",{templateUrl:"frontend/profile/views/my_profile.html",controller:"profileCtrl",resolve:{validate:required}}).when("/settings",{templateUrl:"frontend/settings/views/settings.html",controller:"settingsCtrl",resolve:{validate:required}}).when("/refer-to-friend",{templateUrl:"frontend/refer/views/refer.html",controller:"referCtrl",resolve:{validate:required}}).when("/document-verification",{templateUrl:"frontend/profile/views/dash_verification.html",controller:"profileCtrl",resolve:{validate:required}}).when("/my-booking",{templateUrl:"frontend/profile/views/dash_booking.html",controller:"profileCtrl",resolve:{validate:required}}).when("/transaction",{templateUrl:"frontend/profile/views/dash_transaction.html",controller:"profileCtrl",resolve:{validate:required}}).when("/messages",{templateUrl:"frontend/profile/views/dash_message.html",controller:"profileCtrl",resolve:{validate:required}}).when("/reviews",{templateUrl:"frontend/profile/views/dash_reviews.html",controller:"profileCtrl",resolve:{validate:required}}).when("/dash-services",{templateUrl:"frontend/profile/views/dash_services.html",controller:"profileCtrl",resolve:{validate:required}}).when("/dash-payment-preferences",{templateUrl:"frontend/profile/views/dash_payment_preferences.html",controller:"profileCtrl",resolve:{validate:required}}).when("/dash-booking-summary",{templateUrl:"frontend/profile/views/dash_booking_summary.html",controller:"profileCtrl",resolve:{validate:required}}).when("/about-us",{templateUrl:"frontend/cms/views/about_us.html",controller:"cmsCtrl"}).when("/how-it-works",{templateUrl:"frontend/cms/views/howit_works.html",controller:"cmsCtrl"}).otherwise({redirectTo:"/"})}]);var required=["$q",function(e){var t=e.defer();return localStorage.getItem("t")?t.resolve():t.reject({authentication:!1}),t.promise}],notRequired=["$q",function(e){var t=e.defer();return localStorage.getItem("t")?t.reject({authentication:!0}):t.resolve(),t.promise}];app.factory("http",["$http",function(e){return{get:function(t,o){return e.get(t).then(function(e){return{record:e.data}})},post:function(t,o){return e.post(t,o).then(function(e){return{result:e.data.success,message:e.data.message,data:e.data.record}},function(e){return{message:e.data.errors}})},login:function(t,o){return e.post(t,o).then(function(e){return{result:e.data.success,message:e.data.message,token:e.data.token,user:e.data.user}},function(e){return{message:e.data.errors}})},put:function(){},delete:function(){}}}]),app.factory("localData",[function(){return{token:function(){return localStorage.getItem("t")},data:function(){return JSON.parse(localStorage.getItem("user"))},removeItem:function(e){e.forEach(function(e){localStorage.removeItem(e)})},setUser:function(e){localStorage.setItem("user",JSON.stringify(e))}}}]),app.factory("timeout",["$timeout",function(e){return{fiveHundredMiliSecond:function(t){e(function(){t()},500)}}}]),app.factory("toastyService",["toasty",function(e){return{notification:function(t,o){t===!0?e.success({title:"",msg:o,showClose:!0,clickToClose:!0,timeout:5e3,html:!0,theme:"bootstrap"}):t===!1&&e.error({title:"",msg:o,showClose:!0,clickToClose:!0,timeout:5e3,html:!0,theme:"bootstrap"})},logoutNotification:function(){e.success({title:"",msg:"You'have successfully logged out",showClose:!0,clickToClose:!0,timeout:6e3,html:!0,theme:"bootstrap"})}}}]),app.factory("socket",["$rootScope",function(e){var t=io.connect();return{on:function(e,o){t.on(e,o)},emit:function(e,o){t.emit(e,o)}}}]),app.controller("includesCtrl",["socket","http","timeout","toastyService","localData","$scope","$location",function(e,t,o,n,r,i,a){e.emit("fist-test-socket",function(e){console.log("This is socket response")}),e.on("notification",function(e){console.log(e)}),function(){i.profileInfo=r.data()}(),i.toPage=function(e){a.path(e)},i.logout=function(){var e=["t","user"];r.removeItem(e),o.fiveHundredMiliSecond(function(){a.path("/"),n.logoutNotification()})},i.setClass=function(e){if(a.path().split("/")[1]==e)return!0}}]),app.controller("landingCtrl",["loginSignupPopup","$scope","$location","$rootScope","$http","$mdDialog",function(e,t,o,n,r,i){t.loginPopup=function(t){e.login(t)},t.signUpPopup=function(t){e.signup(t)}}]),app.factory("loginSignupPopup",["$mdDialog",function(e){return{login:function(t){e.show({controller:"loginSignupCtrl",templateUrl:"frontend/popup/login.html",parent:angular.element(document.body),targetEvent:t,clickOutsideToClose:!0}).then(function(e){},function(){})},signup:function(t){e.show({controller:"loginSignupCtrl",templateUrl:"frontend/popup/sign_up.html",parent:angular.element(document.body),targetEvent:t,clickOutsideToClose:!0}).then(function(e){},function(){})}}}]),app.controller("profileCtrl",["toastyService","localData","$scope","$location","$rootScope","http","$mdDialog",function(e,t,o,n,r,i,a){!function(){o.user=t.data(),o.user.dob=new Date(o.user.dob),o.dobMaxDate=new Date}(),o.oneAtATime=!0,o.groups=[{title:"Dynamic Group Header - 1",content:"Dynamic Group Body - 1"},{title:"Dynamic Group Header - 2",content:"Dynamic Group Body - 2"}],o.items=["Item 1","Item 2","Item 3"],o.addItem=function(){var e=o.items.length+1;o.items.push("Item "+e)},o.status={isCustomHeaderOpen:!1,isFirstOpen:!0,isFirstDisabled:!1},o.leaveReviewPopup=function(e){a.show({controller:"includesCtrl",templateUrl:"frontend/popup/leave_review.html",parent:angular.element(document.body),targetEvent:e,clickOutsideToClose:!0}).then(function(e){o.status='You said the information was "'+e+'".'},function(){o.status="You cancelled the dialog."})},o.updateProfile=function(){var n=angular.copy(o.user);["country_code","updated_at","created_at"].forEach(function(e){delete n[e]}),i.post("/update-profile",n).then(function(n){e.notification(n.result,n.message),n.result&&t.setUser(o.user)})}}]),app.controller("cmsCtrl",["localData","$scope","$location",function(e,t,o){console.log("this is cms controller")}]),app.controller("settingsCtrl",["$scope","http","localData","toastyService",function(e,t,o,n){!function(){e.profileInfo=o.data(),e.active={isActive:e.profileInfo.isActive},e.notification={enableNotification:e.profileInfo.enableNotification}}(),e.changePassword=function(){e.userPassword._id=e.profileInfo._id,t.post("/change-password",e.userPassword).then(function(t){n.notification(t.result,t.message),t.result&&(e.userPassword={},e.changePasswordForm.$setPristine(),e.changePasswordForm.$setUntouched())})},e.activeInactive=function(){e.active._id=e.profileInfo._id,t.post("/is-active",e.active).then(function(t){n.notification(t.result,t.message),e.profileInfo.isActive=e.active.isActive,o.setUser(e.profileInfo)})},e.activeInactiveNotification=function(){e.notification._id=e.profileInfo._id,t.post("/notification-setting",e.notification).then(function(t){n.notification(t.result,t.message),e.profileInfo.enableNotification=e.notification.enableNotification,o.setUser(e.profileInfo)})}}]),app.controller("referCtrl",["$scope","http",function(e,t){e.referToFriend=function(){e.buttonStatus=!0,t.get("/refer-to-friend/"+e.friend.email).then(function(t){console.log(t),e.buttonStatus=!1})}}]),app.controller("loginSignupCtrl",["http","toastyService","loginSignupPopup","$mdDialog","$scope","$location","$rootScope","$http",function(e,t,o,n,r,i,a,l){r.userSignInfo={country_code:"+61"},r.dobMaxDate=new Date,r.loginSignup=function(e,t){"login"==t?o.login(e):"signup"==t&&o.signup(e)},r.signUp=function(){r.userSignInfo.password!==r.userSignInfo.cpassword?t.notification(!1,"Password and confirm password is not equal"):r.userSignInfo.is_agree?e.post("/user-signup",r.userSignInfo).then(function(e){t.notification(e.result,e.message),e.result&&r.closeMe()}):t.notification(!1,"Please accept terms and conditions.")},r.login=function(){e.login("/user-login",r.userLogin).then(function(e){e.result===!0?(localStorage.setItem("t",e.token),localStorage.setItem("user",JSON.stringify(e.user)),r.closeMe(),i.path("/my-profile")):t.notification(e.result,e.message)})},r.closeMe=function(){n.hide()}}]);